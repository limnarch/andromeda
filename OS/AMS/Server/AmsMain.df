#include "<df>/dragonfruit.h"

#include "<ll>/OSDLL/OS.h"

fn Main { ... -- ret }
	AmsInit ret!

	ret@ OSCURRENTTHREAD OSThreadTerminate drop
end

fn AmsInit { -- ok }
	auto thandle
	0 // context
	pointerof AmsApiThread // startfunc
	0 // creationflags
	ACCESS_OWNER_ALL // permissions
	"API" // name
	OSCURRENTPROCESS // processhandle
	OSThreadCreate ok! thandle!

	if (ok@)
		return
	end

	thandle@ OSClose drop
end

fn AmsApiThread { context -- ret }
	0 ret!
end